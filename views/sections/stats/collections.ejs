<div class="stat-container stat-collections">
  <a class="stat-anchor" id="Collections"></a>
  <h2 class="stat-header">Collections</h2>
  <div class="stat-content">

    <% max = calculated.collections.maxedCollections === calculated.collections.totalCollections ? 'golden-text' : ''; %>
    <span class="stat-name <%= max %>">Maxed Collections: </span>
    <span class="stat-value <%= max %>"><%= calculated.collections.maxedCollections %> / <%= calculated.collections.totalCollections %></span>

    <% for (const [category, categoryData] of Object.entries(calculated.collections)) { %>
      <% if (categoryData.collections === undefined) continue; %>
      <div class="category-header">
        <div class="category-icon">
          <div class="item-icon <%= skillItems[category.toLowerCase()] ?? "icon-166_0" %>"></div>
        </div>

        <span> <%= category %> </span>
        <% if (categoryData.maxTiers === categoryData.totalTiers) { %>
          <span class="category-header-maxed">max!</span>
        <% } else { %>
          <span class="category-header-detail">(<%= categoryData.maxTiers %> / <%= categoryData.totalTiers %> max)</span>
        <% } %>
      </div>

      <div class="collections">  
        <% for (const collection of categoryData.collections) { %>
          <% const amountsTooltip = collection.amounts.map(amount => `<span class="stat-name">${amount.username}: </span><span class="stat-value">${amount.amount.toLocaleString()}</span>`).join('<br>') + `<br><br><span class="stat-name">Total: </span><span class="stat-value">${collection.totalAmount.toLocaleString()}</span>`; %>

          <div class="chip" data-tippy-content="<%= amountsTooltip %>" data-missing="<%= collection.totalAmount === 0 %>">
            <div class="chip-icon-wrapper">
              <div style="background-image:url(<%= collection.texture %>)" class="item-icon custom-icon"></div>
            </div>

            <div class="chip-text">
              <div class="collection-name <%= collection.tier == collection.maxTier ? 'max-stat' : '' %>">
                <span class="stat-name"> <%= collection.name %> </span>
                <span class="stat-value"> <%= collection.tier %> </span>
              </div>

              <div class="collection-amount">
                <span class="stat-name">Amount: </span> <span class="stat-value"><%= collection.amount.toLocaleString() %></span>
              </div>
            </div>
          </div>
        <% } %>
      </div>
    <% } %>

    <!-- BOSSES -->
    <!-- rewrite once stats/dungeons.js gets added -->
    <div class="category-header">
      <div class="category-icon">
        <div class="item-icon <%= skillItems["bosses"] %>"></div>
      </div>

      <span> Bosses </span>
      <% const maxedTiers = Object.values(calculated.dungeons.boss_collections).filter(boss => boss.maxTier === boss.tier).length; %>
      <% const totalTiers = Object.values(calculated.dungeons.boss_collections).length; %>
      <% if (maxedTiers === totalTiers) { %>
        <span class="category-header-maxed">max!</span>
      <% } else { %>
        <span class="category-header-detail">(<%= maxedTiers %> / <%= totalTiers %> max)</span>
      <% } %>
    </div>

    <div class="collections">  
      <% for (const collection of Object.values(calculated.dungeons.boss_collections)) {
        let claimedTooltip = "";
        if (collection.claimed.length > 0) {
          claimedTooltip += '<span class="stat-name">Claimed items:</span><br>';
          claimedTooltip += collection.claimed.map(item => `<span class="stat-value">- ${item}</span><br>`).join('');
        }

        if (collection.unclaimed.length > 0) {
          claimedTooltip += '<span class="stat-name">Unclaimed items:</span><br>';
          claimedTooltip += collection.unclaimed.map(item => `<span class="stat-value">- ${item}</span><br>`).join('');
        } %>

        <div class="chip" data-tippy-content="<%= claimedTooltip %>" data-missing="<%= collection.killed === 0 %>">
          <div class="chip-icon-wrapper">
            <div style="background-image:url(/head/<%= collection.texture %>)" class="item-icon custom-icon"></div>
          </div>

          <div class="chip-text">
            <div class="collection-name <%= collection.maxed ? 'max-stat' : '' %>">
              <span class="stat-name"> <%= collection.name %> </span>
              <span class="stat-value"> <%= collection.tier %> </span>
            </div>

            <div class="collection-amount">
              <span class="stat-name">Bosses Killed: </span> <span class="stat-value"><%= collection.killed.toLocaleString() %></span>
            </div>
          </div>
        </div>
      <% } %>
    </div>
  </div>
</div>